/**
 * BlueButton.js
 */

// v.0.0.7


(function () {
var Core=function(){var n=function(b){return{el:b,template:Core.template,tag:Core.tag,elsByTag:Core.elsByTag,attr:Core.attr,val:Core.val}},k=function(b){if(b.length){for(var d=[],a=0;a<b.length;a++)d.push(n(b[a]));return d}return n(b)},g=function(){var b=document.createElement("empty");return k(b)};return{parseXML:function(b){if(!b||"string"!==typeof b)return console.log("BB Error: XML data is not a string"),null;var d;if(window.DOMParser)parser=new DOMParser,d=parser.parseFromString(b,"text/xml");
else try{d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(b)}catch(a){console.log("BB ActiveX Exception: Could not parse XML")}return!d||!d.documentElement||d.getElementsByTagName("parsererror").length?(console.log("BB Error: Could not parse XML"),null):k(d)},wrapElement:k,template:function(b){a:{for(var d=this.el,d=d.getElementsByTagName("templateId"),a=0;a<d.length;a++)if(d[a].getAttribute("root")===b){b=d[a];break a}b=void 0}return b?k(b.parentNode):g()},tag:function(b){return(b=
this.el.getElementsByTagName(b)[0])?k(b):g()},elsByTag:function(b){return k(this.el.getElementsByTagName(b))},attr:function(b){return!this.el?null:this.el.getAttribute(b)},val:function(){if(!this.el)return null;try{return this.el.childNodes[0].nodeValue}catch(b){return null}},parseDate:function(b){if(!b||"string"!==typeof b)return console.log("Error: date is not a string"),null;var d=b.substr(0,4),a=b.substr(4,2);b=b.substr(6,2);return new Date(d,a,b)}}}();var Allergies=function(){return{process:function(n,k){var g,b=[];switch(k){case "ccda":g=[];var d,a,c;d=n.template("2.16.840.1.113883.10.20.22.2.6.1");a=d.elsByTag("entry");for(var e=0;e<a.length;e++){c=a[e];d=c.template("2.16.840.1.113883.10.20.22.4.7").tag("code");var f=d.attr("displayName"),h=d.attr("code"),l=d.attr("codeSystem"),q=d.attr("codeSystemName");d=c.template("2.16.840.1.113883.10.20.22.4.7").tag("value");var p=d.attr("displayName"),m=d.attr("code"),r=d.attr("codeSystem"),s=d.attr("codeSystemName");
d=c.template("2.16.840.1.113883.10.20.22.4.9").tag("value");var t=d.attr("displayName"),u=d.attr("code"),v=d.attr("codeSystem");d=c.template("2.16.840.1.113883.10.20.22.4.8").tag("value");var w=d.attr("displayName");d=c.tag("participant").tag("code");var x=d.attr("displayName"),y=d.attr("code"),z=d.attr("codeSystem"),A=d.attr("codeSystemName");d=c.template("2.16.840.1.113883.10.20.22.4.28").tag("value");d.attr("displayName");g.push({name:f,code:h,code_system:l,code_system_name:q,reaction_type_name:p,
reaction_type_code:m,reaction_type_code_system:r,reaction_type_code_system_name:s,reaction_name:t,reaction_code:u,reaction_code_system:v,severity:w,allergen_name:x,allergen_code:y,allergen_code_system:z,allergen_code_system_name:A})}break;case "va_c32":g=[];d=n.template("2.16.840.1.113883.3.88.11.83.102");a=d.elsByTag("entry");for(e=0;e<a.length;e++)c=a[e],d=c.template("2.16.840.1.113883.10.20.1.28").tag("code"),f=d.tag("originalText").val(),h=d.attr("code"),l=d.attr("codeSystem"),q=d.attr("codeSystemName"),
d=c.template("2.16.840.1.113883.10.20.1.54").tag("value"),p=d.attr("displayName"),m=d.attr("code"),r=d.attr("codeSystem"),s=d.attr("codeSystemName"),d=c.template("2.16.840.1.113883.10.20.1.54").tag("value"),t=d.attr("displayName"),u=d.attr("code"),v=d.attr("codeSystem"),d=c.template("2.16.840.1.113883.10.20.1.55").tag("value"),w=d.attr("displayName"),d=c.tag("participant").tag("code"),x=c.tag("participant").tag("name").val(),y=d.attr("code"),z=d.attr("codeSystem"),A=d.attr("codeSystemName"),d=c.template("2.16.840.1.113883.10.20.22.4.28").tag("value"),
d.attr("displayName"),g.push({name:f,code:h,code_system:l,code_system_name:q,reaction_type_name:p,reaction_type_code:m,reaction_type_code_system:r,reaction_type_code_system_name:s,reaction_name:t,reaction_code:u,reaction_code_system:v,severity:w,allergen_name:x,allergen_code:y,allergen_code_system:z,allergen_code_system_name:A});break;case "json":return{}}for(d=0;d<g.length;d++)b.push({date:{value:null,low:null,high:null},observation_date:{low:null},name:g[d].name,code:g[d].code,code_system:g[d].code_system,
code_system_name:g[d].code_system_name,status:g[d].status,severity:g[d].severity,reaction:{date:{low:null},name:g[d].reaction_name,code:g[d].reaction_code,code_system:g[d].reaction_code_system},reaction_type:{name:g[d].reaction_type_name,code:g[d].reaction_type_code,code_system:g[d].reaction_code_system,code_system_name:g[d].reaction_type_code_system_name},allergen:{name:g[d].allergen_name,code:g[d].allergen_code,code_system:g[d].allergen_code_system,code_system_name:g[d].allergen_code_system_name}});
return b}}}();var Demographics=function(){var n=Core.parseDate;return{process:function(k,g){var b;switch(g){case "ccda":b={};var d,a;d=k.template("2.16.840.1.113883.10.20.22.1.1");a=d.tag("patientRole");d=a.tag("patient").tag("name");b.prefix=d.tag("prefix").val();b.given=d.tag("given").val();b.family=d.tag("family").val();d=a.tag("patient");b.dob=n(d.tag("birthTime").attr("value"));b.gender=d.tag("administrativeGenderCode").attr("displayName");b.marital_status=d.tag("maritalStatusCode").attr("displayName");d=
a.tag("addr");b.street=d.tag("streetAddressLine").val();b.city=d.tag("city").val();b.state=d.tag("state").val();b.zip=d.tag("postalCode").val();b.country=d.tag("country").val();d=a.tag("telecom");b.home=d.attr("value");b.work=null;b.mobile=null;b.email=null;b.race=a.tag("raceCode").attr("displayName");b.ethnicity=a.tag("ethnicGroupCode").attr("displayName");b.religion=a.tag("religiousAffiliationCode").attr("displayName");d=a.tag("birthplace");b.birthplace_state=d.tag("state").val();b.birthplace_zip=
d.tag("postalCode").val();b.birthplace_country=d.tag("country").val();d=a.tag("guardian");b.guardian_relationship=d.tag("code").attr("displayName");b.guardian_home=d.tag("telecom").attr("value");d=d.tag("guardianPerson");b.guardian_given=d.tag("given").val();b.guardian_family=d.tag("family").val();d=a.tag("guardian").tag("addr");b.guardian_street=d.tag("streetAddressLine").val();b.guardian_city=d.tag("city").val();b.guardian_state=d.tag("state").val();b.guardian_zip=d.tag("postalCode").val();b.guardian_country=
d.tag("country").val();d=a.tag("providerOrganization");b.provider_organization=d.tag("name").val();b.provider_phone=d.tag("telecom").attr("value");b.provider_street=d.tag("streetAddressLine").val();b.provider_city=d.tag("city").val();b.provider_state=d.tag("state").val();b.provider_zip=d.tag("postalCode").val();b.provider_country=d.tag("country").val();break;case "va_c32":b={};d=k.template("1.3.6.1.4.1.19376.1.5.3.1.1.1");a=d.tag("patientRole");d=a.tag("patient").tag("name");b.prefix=null;b.given=
d.tag("given").val();b.family=d.tag("family").val();d=a.tag("patient");b.dob=n(d.tag("birthTime").attr("value"));b.gender=d.tag("administrativeGenderCode").attr("displayName");b.marital_status=d.tag("maritalStatusCode").attr("displayName");d=a.tag("addr");b.street=d.tag("streetAddressLine").val();b.city=d.tag("city").val();b.state=d.tag("state").val();b.zip=d.tag("postalCode").val();b.country=d.tag("country").val();d=a.tag("telecom");b.home=d.attr("value");b.work=null;b.mobile=null;b.email=null;b.race=
a.tag("raceCode").attr("displayName");b.ethnicity=a.tag("ethnicGroupCode").attr("displayName");b.religion=a.tag("religiousAffiliationCode").attr("displayName");d=a.tag("birthplace");b.birthplace_state=d.tag("state").val();b.birthplace_zip=d.tag("postalCode").val();b.birthplace_country=d.tag("country").val();d=a.tag("guardian");b.guardian_relationship=d.tag("code").attr("displayName");b.guardian_home=d.tag("telecom").attr("value");d=d.tag("guardianPerson");b.guardian_given=d.tag("given").val();b.guardian_family=
d.tag("family").val();d=a.tag("guardian").tag("addr");b.guardian_street=d.tag("streetAddressLine").val();b.guardian_city=d.tag("city").val();b.guardian_state=d.tag("state").val();b.guardian_zip=d.tag("postalCode").val();b.guardian_country=d.tag("country").val();d=a.tag("providerOrganization");b.provider_organization=d.tag("name").val();b.provider_phone=d.tag("telecom").attr("value");b.provider_street=d.tag("streetAddressLine").val();b.provider_city=d.tag("city").val();b.provider_state=d.tag("state").val();
b.provider_zip=d.tag("postalCode").val();b.provider_country=d.tag("country").val();break;case "json":return{}}return{name:{prefix:b.prefix,given:b.given,family:b.family},dob:b.dob,gender:b.gender,marital_status:b.marital_status,address:{street:b.street,city:b.city,state:b.state,zip:b.zip,country:b.country},phone:{home:b.home,work:b.work,mobile:b.mobile},email:b.email,race:b.race,ethnicity:b.ethnicity,religion:b.religion,birthplace:{state:b.birthplace_state,zip:b.birthplace_zip,country:b.birthplace_country},
guardian:{name:{given:b.guardian_given,family:b.guardian_family},relationship:b.guardian_relationship,address:{street:b.guardian_street,city:b.guardian_city,state:b.guardian_state,zip:b.guardian_zip,country:b.guardian_country},phone:{home:b.guardian_home}},provider:{organization:b.provider_organization,phone:b.provider_phone,address:{street:b.provider_street,city:b.provider_city,state:b.provider_state,zip:b.provider_zip,country:b.provider_country}}}}}}();var Encounters=function(){var n=Core.parseDate;return{process:function(k,g){var b,d=[];switch(g){case "ccda":b=[];var a,c,e;a=k.template("2.16.840.1.113883.10.20.22.2.22.1");c=a.elsByTag("entry");for(var f=0;f<c.length;f++){e=c[f];var h=n(e.tag("effectiveTime").attr("value"));a=e.tag("code");var l=a.attr("displayName"),q=a.attr("code"),p=a.attr("codeSystem"),m=a.attr("codeSystemName"),r=a.attr("codeSystemVersion");a=e.tag("value");var s=a.attr("displayName"),t=a.attr("code"),u=a.attr("codeSystem");
a=e.tag("translation");var v=a.attr("displayName"),w=a.attr("code"),x=a.attr("codeSystem"),y=a.attr("codeSystemName");a=e.tag("performer").tag("code");var z=a.attr("displayName");a.attr("code");var A=a.attr("codeSystem"),B=a.attr("codeSystemName");a=e.tag("participant");e=a.tag("code").attr("displayName");var C=a.tag("streetAddressLine").val(),D=a.tag("city").val(),E=a.tag("state").val(),F=a.tag("postalCode").val();a=a.tag("country").val();b.push({date:h,name:l,code:q,code_system:p,code_system_name:m,
code_system_version:r,finding_name:s,finding_code:t,finding_code_system:u,translation_name:v,translation_code:w,translation_code_system:x,translation_code_system_name:y,performer_name:z,performer_code_system:A,performer_code_system_name:B,organization:e,street:C,city:D,state:E,zip:F,country:a})}break;case "va_c32":b=[];a=k.template("2.16.840.1.113883.10.20.1.3");c=a.elsByTag("entry");for(f=0;f<c.length;f++)e=c[f],h=n(e.tag("effectiveTime").tag("low").attr("value")),a=e.tag("code"),l=a.attr("displayName"),
q=a.attr("code"),p=a.attr("codeSystem"),m=a.attr("codeSystemName"),r=a.attr("codeSystemVersion"),a=e.tag("value"),s=a.attr("displayName"),t=a.attr("code"),u=a.attr("codeSystem"),a=e.tag("translation"),v=a.attr("displayName"),w=a.attr("code"),x=a.attr("codeSystem"),y=a.attr("codeSystemName"),a=e.tag("performer").tag("code"),z=a.attr("displayName"),a.attr("code"),A=a.attr("codeSystem"),B=a.attr("codeSystemName"),a=e.tag("participant"),e=a.tag("code").attr("displayName"),C=a.tag("streetAddressLine").val(),
D=a.tag("city").val(),E=a.tag("state").val(),F=a.tag("postalCode").val(),a=a.tag("country").val(),b.push({date:h,name:l,code:q,code_system:p,code_system_name:m,code_system_version:r,finding_name:s,finding_code:t,finding_code_system:u,translation_name:v,translation_code:w,translation_code_system:x,translation_code_system_name:y,performer_name:z,performer_code_system:A,performer_code_system_name:B,organization:e,street:C,city:D,state:E,zip:F,country:a});break;case "json":return{}}for(c=0;c<b.length;c++)d.push({date:b[c].date,
name:b[c].name,code:b[c].code,code_system:b[c].code_system,code_system_name:b[c].code_system_name,code_system_version:b[c].code_system_version,finding:{name:b[c].finding_name,code:b[c].finding_code,code_system:b[c].finding_code_system},translation:{name:b[c].translation_name,code:b[c].translation_code,code_system:b[c].translation_code_system,code_system_name:b[c].translation_code_system_name},performer:{name:b[c].performer_name,code:b[c].performer_code,code_system:b[c].performer_code_system,code_system_name:b[c].performer_code_system_name},
location:{organization:b[c].organization,street:b[c].street,city:b[c].city,state:b[c].state,zip:b[c].zip,country:b[c].country}});return d}}}();var Immunizations=function(){var n=Core.parseDate;return{process:function(k,g){var b,d=[];switch(g){case "ccda":b=[];var a,c,e;a=k.template("2.16.840.1.113883.10.20.22.2.2");c=a.elsByTag("entry");for(var f=0;f<c.length;f++){e=c[f];a=e.tag("effectiveTime");var h=n(a.attr("value"));a=e.template("2.16.840.1.113883.10.20.22.4.54").tag("code");var l=a.attr("displayName"),q=a.attr("code"),p=a.attr("codeSystem"),m=a.attr("codeSystemName");a=e.template("2.16.840.1.113883.10.20.22.4.54").tag("translation");
var r=a.attr("displayName"),s=a.attr("code"),t=a.attr("codeSystem"),u=a.attr("codeSystemName");a=e.tag("routeCode");var v=a.attr("displayName"),w=a.attr("code"),x=a.attr("codeSystem"),y=a.attr("codeSystemName");a=e.template("2.16.840.1.113883.10.20.22.4.20");e=a.tag("text").val();a=a.tag("code");var z=a.attr("displayName"),A=a.attr("code");a=a.attr("codeSystem");b.push({date:h,product_name:l,product_code:q,product_code_system:p,product_code_system_name:m,translation_name:r,translation_code:s,translation_code_system:t,
translation_code_system_name:u,route_name:v,route_code:w,route_code_system:x,route_code_system_name:y,instructions_text:e,education_name:z,education_code:A,education_code_system:a})}break;case "va_c32":b=[];a=k.template("2.16.840.1.113883.10.20.1.6");c=a.elsByTag("entry");for(f=0;f<c.length;f++)e=c[f],a=e.tag("effectiveTime"),h=n(a.attr("value")),a=e.template("2.16.840.1.113883.10.20.1.53").tag("code"),l=a.attr("displayName"),q=a.attr("code"),p=a.attr("codeSystem"),m=a.attr("codeSystemName"),a=e.template("2.16.840.1.113883.10.20.22.4.54").tag("translation"),
r=a.attr("displayName"),s=a.attr("code"),t=a.attr("codeSystem"),u=a.attr("codeSystemName"),a=e.tag("routeCode"),v=a.attr("displayName"),w=a.attr("code"),x=a.attr("codeSystem"),y=a.attr("codeSystemName"),a=e.template("2.16.840.1.113883.10.20.22.4.20"),e=a.tag("text").val(),a=a.tag("code"),z=a.attr("displayName"),A=a.attr("code"),a=a.attr("codeSystem"),b.push({date:h,product_name:l,product_code:q,product_code_system:p,product_code_system_name:m,translation_name:r,translation_code:s,translation_code_system:t,
translation_code_system_name:u,route_name:v,route_code:w,route_code_system:x,route_code_system_name:y,instructions_text:e,education_name:z,education_code:A,education_code_system:a});break;case "json":return{}}for(c=0;c<b.length;c++)d.push({date:b[c].date,product:{name:b[c].product_name,code:b[c].product_code,code_system:b[c].product_code_system,code_system_name:b[c].product_code_system_name,translation:{name:b[c].translation_name,code:b[c].translation_code,code_system:b[c].translation_code_system,
code_system_name:b[c].translation_code_system_name}},route:{name:b[c].route_name,code:b[c].route_code,code_system:b[c].route_code_system,code_system_name:b[c].route_code_system_name},instructions:b[c].instructions_text,education_type:{name:b[c].education_name,code:b[c].education_code,code_system:b[c].education_code_system}});return d}}}();var Labs=function(){var n=Core.parseDate;return{process:function(k,g){var b,d=[];switch(g){case "ccda":b=[];var a=[],c,e,f,h;c=k.template("2.16.840.1.113883.10.20.22.2.3.1");e=c.elsByTag("entry");for(var l=0;l<e.length;l++){f=e[l];c=f.tag("code");var q=c.attr("displayName"),p=c.attr("code"),m=c.attr("codeSystem"),r=c.attr("codeSystemName");f=f.elsByTag("component");for(var s=0;s<f.length;s++){h=f[s];var t=n(h.tag("effectiveTime").attr("value"));c=h.tag("code");var u=c.attr("displayName"),v=c.attr("code"),
w=c.attr("codeSystem"),x=c.attr("codeSystemName");c=h.tag("value");h=c.attr("value");c=c.attr("unit");reference_high=reference_low=null;a.push({date:t,name:u,value:h,unit:c,code:v,code_system:w,code_system_name:x,reference_low:reference_low,reference_high:reference_high})}b.push({name:q,code:p,code_system:m,code_system_name:r,results:a})}break;case "va_c32":b=[];a=[];c=k.template("2.16.840.1.113883.10.20.1.14");e=c.elsByTag("entry");for(l=0;l<e.length;l++){f=e[l];c=f.tag("code");q=c.attr("displayName");
p=c.attr("code");m=c.attr("codeSystem");r=c.attr("codeSystemName");f=f.elsByTag("component");for(s=0;s<f.length;s++)h=f[s],t=n(h.tag("effectiveTime").attr("value")),c=h.tag("code"),u=c.tag("originalText").val(),v=c.attr("code"),w=c.attr("codeSystem"),x=c.attr("codeSystemName"),c=h.tag("value"),h=c.attr("value"),c=c.attr("unit"),reference_high=reference_low=null,a.push({date:t,name:u,value:h,unit:c,code:v,code_system:w,code_system_name:x,reference_low:reference_low,reference_high:reference_high});
b.push({name:q,code:p,code_system:m,code_system_name:r,results:a})}break;case "json":return{}}for(a=0;a<b.length;a++){e=b[a];l={name:e.name,code:e.code,code_system:e.code_system,code_system_name:e.code_system_name};q=[];for(p=0;p<e.results.length;p++)m=e.results[p],q.push({date:m.date,name:m.name,value:m.value,unit:m.unit,code:m.code,code_system:m.code_system,code_system_name:m.code_system_name,reference:{low:m.reference_low,high:m.reference_high}});l.results=q;d.push(l)}return d}}}();var Medications=function(){var n=Core.parseDate;return{process:function(k,g){var b,d=[];switch(g){case "ccda":b=[];var a,c,e;a=k.template("2.16.840.1.113883.10.20.22.2.1.1");c=a.elsByTag("entry");for(var f=0;f<c.length;f++){e=c[f];a=e.tag("effectiveTime");var h=n(a.tag("low").attr("value")),l=n(a.tag("high").attr("value"));a=e.tag("manufacturedProduct").tag("code");var q=a.attr("displayName"),p=a.attr("code"),m=a.attr("codeSystem");a=e.tag("manufacturedProduct").tag("translation");var r=a.attr("displayName"),
s=a.attr("code"),t=a.attr("codeSystem"),u=a.attr("codeSystemName");a=e.tag("doseQuantity");var v=a.attr("value"),w=a.attr("unit");a=e.tag("rateQuantity");var x=a.attr("value"),y=a.attr("unit");a=e.tag("precondition").tag("value");var z=a.attr("displayName"),A=a.attr("code"),B=a.attr("codeSystem");a=e.template("2.16.840.1.113883.10.20.22.4.19").tag("value");var C=a.attr("displayName"),D=a.attr("code"),E=a.attr("codeSystem");a=e.tag("routeCode");var F=a.attr("displayName"),G=a.attr("code"),H=a.attr("codeSystem"),
I=a.attr("codeSystemName");a=e.tag("participant").tag("code");var J=a.attr("displayName"),K=a.attr("code"),L=a.attr("codeSystem"),M=a.attr("codeSystemName");a=e.tag("administrationUnitCode");var N=a.attr("displayName"),O=a.attr("code"),P=a.attr("codeSystem"),Q=a.attr("codeSystemName");a=e.tag("performer");a=a.tag("name").val();b.push({low:h,high:l,product_name:q,product_code:p,product_code_system:m,translation_name:r,translation_code:s,translation_code_system:t,translation_code_system_name:u,dose_value:v,
dose_unit:w,rate_quantity_value:x,rate_quantity_unit:y,precondition_name:z,precondition_code:A,precondition_code_system:B,reason_name:C,reason_code:D,reason_code_system:E,route_name:F,route_code:G,route_code_system:H,route_code_system_name:I,vehicle_name:J,vehicle_code:K,vehicle_code_system:L,vehicle_code_system_name:M,administration_name:N,administration_code:O,administration_code_system:P,administration_code_system_name:Q,prescriber_organization:a,prescriber_person:null})}break;case "va_c32":b=
[];a=k.template("2.16.840.1.113883.3.88.11.83.112");c=a.elsByTag("entry");for(f=0;f<c.length;f++)e=c[f],a=e.tag("effectiveTime"),h=n(a.tag("low").attr("value")),l=n(a.tag("high").attr("value")),a=e.tag("manufacturedProduct").tag("code"),q=a.attr("displayName"),p=a.attr("code"),m=a.attr("codeSystem"),a=e.tag("manufacturedProduct").tag("translation"),r=a.attr("displayName"),s=a.attr("code"),t=a.attr("codeSystem"),u=a.attr("codeSystemName"),a=e.tag("doseQuantity"),v=a.attr("value"),w=a.attr("unit"),
a=e.tag("rateQuantity"),x=a.attr("value"),y=a.attr("unit"),a=e.tag("precondition").tag("value"),z=a.attr("displayName"),A=a.attr("code"),B=a.attr("codeSystem"),a=e.template("2.16.840.1.113883.10.20.22.4.19").tag("value"),C=a.attr("displayName"),D=a.attr("code"),E=a.attr("codeSystem"),a=e.tag("routeCode"),F=a.attr("displayName"),G=a.attr("code"),H=a.attr("codeSystem"),I=a.attr("codeSystemName"),a=e.tag("participant").tag("code"),J=a.attr("displayName"),K=a.attr("code"),L=a.attr("codeSystem"),M=a.attr("codeSystemName"),
a=e.tag("administrationUnitCode"),N=a.attr("displayName"),O=a.attr("code"),P=a.attr("codeSystem"),Q=a.attr("codeSystemName"),a=e.tag("performer"),a=a.tag("name").val(),b.push({low:h,high:l,product_name:q,product_code:p,product_code_system:m,translation_name:r,translation_code:s,translation_code_system:t,translation_code_system_name:u,dose_value:v,dose_unit:w,rate_quantity_value:x,rate_quantity_unit:y,precondition_name:z,precondition_code:A,precondition_code_system:B,reason_name:C,reason_code:D,reason_code_system:E,
route_name:F,route_code:G,route_code_system:H,route_code_system_name:I,vehicle_name:J,vehicle_code:K,vehicle_code_system:L,vehicle_code_system_name:M,administration_name:N,administration_code:O,administration_code_system:P,administration_code_system_name:Q,prescriber_organization:a,prescriber_person:null});break;case "json":return{}}for(c=0;c<b.length;c++)d.push({effective_time:{low:b[c].low,high:b[c].high},product:{name:b[c].product_name,code:b[c].product_code,code_system:b[c].product_code_system,
translation:{name:b[c].translation_name,code:b[c].translation_code,code_system:b[c].translation_code_system,code_system_name:b[c].translation_code_system_name}},dose_quantity:{value:b[c].dose_value,unit:b[c].dose_unit},rate_quantity:{value:b[c].rate_quantity_value,unit:b[c].rate_quantity_unit},precondition:{name:b[c].precondition_name,code:b[c].precondition_code,code_system:b[c].precondition_code_system},reason:{name:b[c].reason_name,code:b[c].reason_code,code_system:b[c].reason_code_system},route:{name:b[c].route_name,
code:b[c].route_code,code_system:b[c].route_code_system,code_system_name:b[c].route_code_system_name},vehicle:{name:b[c].vehicle_name,code:b[c].vehicle_code,code_system:b[c].vehicle_code_system,code_system_name:b[c].vehicle_code_system_name},administration:{name:b[c].administration_name,code:b[c].administration_code,code_system:b[c].administration_code_system,code_system_name:b[c].administration_code_system_name},prescriber:{organization:b[c].prescriber_organization,person:b[c].prescriber_person}});
return d}}}();var Problems=function(){var n=Core.parseDate;return{process:function(k,g){var b,d=[];switch(g){case "ccda":b=[];var a,c,e;a=k.template("2.16.840.1.113883.10.20.22.2.5");c=a.elsByTag("entry");for(var f=0;f<c.length;f++){e=c[f];a=e.tag("effectiveTime");var h=n(a.tag("low").attr("value")),l=n(a.tag("high").attr("value"));a=e.template("2.16.840.1.113883.10.20.22.4.4").tag("code");var q=a.attr("displayName"),p=a.attr("code"),m=a.attr("codeSystem");a=e.template("2.16.840.1.113883.10.20.22.4.6");var r=a.tag("value").attr("displayName");
a=e.template("2.16.840.1.113883.10.20.22.4.31");a=parseInt(a.tag("value").attr("value"));b.push({from:h,to:l,name:q,code:p,code_system:m,status:r,age:a})}break;case "va_c32":b=[];a=k.template("2.16.840.1.113883.10.20.1.11");c=a.elsByTag("entry");for(f=0;f<c.length;f++)e=c[f],a=e.tag("effectiveTime"),h=n(a.tag("low").attr("value")),l=n(a.tag("high").attr("value")),a=e.template("2.16.840.1.113883.10.20.1.28").tag("code"),q=a.tag("originalText").val(),p=a.attr("code"),m=a.attr("codeSystem"),a=e.template("2.16.840.1.113883.10.20.22.4.6"),
r=a.tag("value").attr("displayName"),a=e.template("2.16.840.1.113883.10.20.22.4.31"),a=parseInt(a.tag("value").attr("value")),b.push({from:h,to:l,name:q,code:p,code_system:m,status:r,age:a});break;case "json":return{}}for(c=0;c<b.length;c++)d.push({date:{from:b[c].from,to:b[c].to},name:b[c].name,status:b[c].status,age:b[c].age,code:b[c].code,code_system:b[c].code_system});return d}}}();var Procedures=function(){var n=Core.parseDate;return{process:function(k,g){var b,d=[];switch(g){case "ccda":b=[];var a,c,e;a=k.template("2.16.840.1.113883.10.20.22.2.7");c=a.elsByTag("entry");for(var f=0;f<c.length;f++){e=c[f];a=e.tag("effectiveTime");var h=n(a.attr("value"));a=e.tag("code");var l=a.attr("displayName"),q=a.attr("code"),p=a.attr("codeSystem");a=e.tag("performer");var m=a.tag("name").val(),r=a.tag("telecom").attr("value"),s=a.tag("streetAddressLine").val(),t=a.tag("city").val(),u=
a.tag("state").val(),v=a.tag("postalCode").val(),w=a.tag("country").val();a=e.tag("participant").tag("code");e=a.attr("displayName");var x=a.attr("code");a=a.attr("codeSystem");b.push({date:h,name:l,code:q,code_system:p,specimen_name:null,specimen_code:null,specimen_code_system:null,organization:m,phone:r,street:s,city:t,state:u,zip:v,country:w,device_name:e,device_code:x,device_code_system:a})}break;case "va_c32":b=[];a=k.template("2.16.840.1.113883.10.20.1.12");c=a.elsByTag("entry");for(f=0;f<c.length;f++)e=
c[f],a=e.tag("effectiveTime"),h=n(a.tag("low").attr("value")),a=e.tag("code"),l=a.tag("originalText").val(),q=a.attr("code"),p=a.attr("codeSystem"),a=e.tag("performer"),m=a.tag("name").val(),r=a.tag("telecom").attr("value"),s=a.tag("streetAddressLine").val(),t=a.tag("city").val(),u=a.tag("state").val(),v=a.tag("postalCode").val(),w=a.tag("country").val(),a=e.tag("participant").tag("code"),e=a.attr("displayName"),x=a.attr("code"),a=a.attr("codeSystem"),b.push({date:h,name:l,code:q,code_system:p,specimen_name:null,
specimen_code:null,specimen_code_system:null,organization:m,phone:r,street:s,city:t,state:u,zip:v,country:w,device_name:e,device_code:x,device_code_system:a});break;case "json":return{}}for(c=0;c<b.length;c++)d.push({date:b[c].date,name:b[c].name,code:b[c].code,code_system:b[c].code_system,specimen:{name:b[c].specimen_name,code:b[c].specimen_code,code_system:b[c].specimen_code_system},performer:{organization:b[c].organization,street:b[c].street,city:b[c].city,state:b[c].state,zip:b[c].zip,country:b[c].country,
phone:b[c].phone},device:{name:b[c].device_name,code:b[c].device_code,code_system:b[c].device_code_system}});return d}}}();var Vitals=function(){var n=Core.parseDate;return{process:function(k,g){var b,d=[];switch(g){case "ccda":b=[];var a=[],c,e,f,h;c=k.template("2.16.840.1.113883.10.20.22.2.4.1");e=c.elsByTag("entry");for(var l=0;l<e.length;l++){f=e[l];c=f.tag("effectiveTime");var q=n(c.attr("value"));f=f.elsByTag("component");for(var p=0;p<f.length;p++){h=f[p];c=h.tag("code");var m=c.attr("displayName"),r=c.attr("code"),s=c.attr("codeSystem"),t=c.attr("codeSystemName");c=h.tag("value");h=c.attr("value");c=c.attr("unit");
a.push({name:m,code:r,code_system:s,code_system_name:t,value:h,unit:c})}b.push({date:q,results:a})}break;case "va_c32":b=[];a=[];c=k.template("2.16.840.1.113883.10.20.1.16");e=c.elsByTag("entry");for(l=0;l<e.length;l++){f=e[l];c=f.tag("effectiveTime");q=n(c.attr("value"));f=f.elsByTag("component");for(p=0;p<f.length;p++)h=f[p],c=h.tag("code"),m=c.attr("displayName"),r=c.attr("code"),s=c.attr("codeSystem"),t=c.attr("codeSystemName"),c=h.tag("value"),h=c.attr("value"),c=c.attr("unit"),a.push({name:m,
code:r,code_system:s,code_system_name:t,value:h,unit:c});b.push({date:q,results:a})}break;case "json":return{}}for(a=0;a<b.length;a++){e=b[a];l={date:e.date};q=[];for(c=0;c<e.results.length;c++)f=e.results[c],q.push({name:f.name,code:f.code,code_system:f.code_system,code_system_name:f.code_system_name,value:f.value,unit:f.unit});l.results=q;d.push(l)}return d}}}();var BlueButton=function(n){var k=null,g="",b={},d=function(a){for(var b=0;b<a.length;b++)a[b].json=function(){return JSON.stringify(this,null,2)}};n=n.replace(/^\s+|\s+$/g,"");if("<?xml"==n.substr(0,5))k=Core.parseXML(n),g="empty"==k.template("1.3.6.1.4.1.19376.1.5.3.1.1.1").el.tagName.toLowerCase()?"ccda":"va_c32",b.document={type:g},b.allergies=Allergies.process(k,g),b.demographics=Demographics.process(k,g),b.encounters=Encounters.process(k,g),b.immunizations=Immunizations.process(k,g),b.labs=Labs.process(k,
g),b.medications=Medications.process(k,g),b.problems=Problems.process(k,g),b.procedures=Procedures.process(k,g),b.vitals=Vitals.process(k,g),d([b,b.document,b.allergies,b.demographics,b.encounters,b.immunizations,b.labs,b.medications,b.problems,b.procedures,b.vitals]);else{g="json";try{var a=JSON.parse(n)}catch(c){console.log("BB Exception: Could not parse JSON")}b.document={type:g};b.allergies=Allergies.process(a,g);b.demographics=Demographics.process(a,g);b.encounters=Encounters.process(a,g);b.immunizations=
Immunizations.process(a,g);b.labs=Labs.process(a,g);b.medications=Medications.process(a,g);b.problems=Problems.process(a,g);b.procedures=Procedures.process(a,g);b.vitals=Vitals.process(a,g)}return{data:b,xmlDOM:k,document:function(){return b.document},allergies:function(){return b.allergies},demographics:function(){return b.demographics},encounters:function(){return b.encounters},immunizations:function(){return b.immunizations},labs:function(){return b.labs},medications:function(){return b.medications},
problems:function(){return b.problems},procedures:function(){return b.procedures},vitals:function(){return b.vitals}}};window.BlueButton=BlueButton;
})();
